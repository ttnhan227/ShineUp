@model Client.Controllers.CommunityController.CommunityDetailsResponse
@{
    ViewData["Title"] = "Chi tiết cộng đồng";
    string role = ViewBag.UserRole as string ?? "None";
    int currentUserId = (int)ViewBag.CurrentUserId;
}

<h2>@Model.Community.Name</h2>
<p>@Model.Community.Description</p>
<p><strong>Ngày tạo:</strong> @Model.Community.CreatedAt.ToString("dd/MM/yyyy")</p>
<p><strong>Vai trò của bạn:</strong> <span class="badge bg-info text-dark">@role</span></p>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}
@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}

<div class="mb-3">
    @if (role == "Admin")
    {
        <p class="text-success">Bạn là quản trị viên. Bạn có toàn quyền quản lý cộng đồng.</p>
    }
    else if (role == "Member")
    {
        <form method="post" asp-action="Leave" asp-route-communityId="@Model.Community.CommunityID" class="d-inline">
            <button type="submit" class="btn btn-outline-danger">Rời khỏi cộng đồng</button>
        </form>
    }
    else
    {
        <form method="post" asp-action="Join" asp-route-communityId="@Model.Community.CommunityID" class="d-inline">
            <button type="submit" class="btn btn-outline-primary">Tham gia cộng đồng</button>
        </form>
    }
</div>

<hr />
<h3>Danh sách thành viên</h3>
@{
    ViewBag.CurrentUserId = currentUserId;
}
@await Html.PartialAsync("_CommunityMemberListPartial", Model.Members)